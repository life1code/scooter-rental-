generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  name          String?
  role          String    @default("user")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Profiles
  hostProfile   HostProfile?
  adminProfile  AdminProfile?

  bookings      Booking[]
}

model HostProfile {
  id                 String    @id @default(uuid())
  userId             String    @unique
  institutionName    String
  institutionAddress String
  nicNumber          String
  nicPhoto           String
  phoneNumber        String
  approvalStatus     String    @default("pending")
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  user               User      @relation(fields: [userId], references: [id])
  scooters           Scooter[]
}

model AdminProfile {
  id        String   @id @default(uuid())
  userId    String   @unique
  level     Int      @default(1) // Can be used for different admin levels later
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id])
}

model Scooter {
  id              String        @id @default(uuid())
  name            String
  type            String
  pricePerDay     Float
  rating          Float         @default(5)
  reviews         Int           @default(0)
  image           String
  description     String
  isSpotlight     Boolean       @default(false)
  manufacturerUrl String?
  location        String        @default("Unawatuna")
  ownerName       String        @default("Ride Owner")
  ownerWhatsapp   String        @default("+94700000000")
  specs           Json
  status          String        @default("Available")
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  model           String        @default("Standard")
  lastLat         Float?
  lastLng         Float?
  hostId          String?
  displayOrder    Int           @default(0)
  blockedDates    BlockedDate[]
  bookings        Booking[]
  
  // Point to HostProfile instead of User
  host            HostProfile?  @relation(fields: [hostId], references: [id])
}

model BlockedDate {
  id        String   @id @default(uuid())
  scooterId String
  date      DateTime
  reason    String?  @default("Admin Blocked")
  createdAt DateTime @default(now())
  scooter   Scooter  @relation(fields: [scooterId], references: [id])

  @@unique([scooterId, date])
}

model Review {
  id       String   @id @default(uuid())
  name     String
  location String
  rating   Int
  content  String
  date     DateTime @default(now())
  bike     String
  approved Boolean  @default(true)
  avatar   String   @default("https://i.pravatar.cc/150?u=default")
}

model Booking {
  id                 String   @id
  scooterId          String
  userId             String?
  riderName          String
  riderEmail         String?
  riderPhone         String
  riderPassport      String
  startDate          DateTime
  endDate            DateTime
  totalAmount        Float
  status             String   @default("Pending")
  verificationStatus String   @default("Pending")
  documents          Json?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  lastLat            Float?
  lastLng            Float?
  scooter            Scooter  @relation(fields: [scooterId], references: [id])
  user               User?    @relation(fields: [userId], references: [id])
}
